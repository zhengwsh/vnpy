{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 44,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": [
    "import pandas as pd\n",
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tushare as ts\n",
    "import sys\n",
    "reload(sys)\n",
    "sys.setdefaultencoding('utf8')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 45,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "这是<font color='red'>HTML代码</font>运行测试"
      ],
      "text/plain": [
       "<IPython.core.display.HTML object>"
      ]
     },
     "execution_count": 45,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "from IPython.display import HTML\n",
    "HTML('这是<font color=\\'red\\'>HTML代码</font>运行测试')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 46,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "# 获取前复权数据\n",
    "df = ts.get_k_data('300017',start='2016-01-01',end='2016-12-31')\n",
    "#print \"df first 3:\",df.head(3)\n",
    "datastr = ''\n",
    "\n",
    "for idx in df.index:\n",
    "    rowstr = '[\\'%s\\',%s,%s,%s,%s]' %(df.ix[idx]['date'],\n",
    "                                      df.ix[idx]['open'],\n",
    "                                      df.ix[idx]['close'],\n",
    "                                      df.ix[idx]['low'],\n",
    "                                      df.ix[idx]['high'])\n",
    "    datastr += rowstr + ','\n",
    "datastr = datastr[:-1]\n",
    "#print \"datastr is:,\"datastr\n",
    "\n",
    "# 获取股票名称\n",
    "name = ts.get_realtime_quotes('300017')['name'][0]\n",
    "#print \"name is:,\"name"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 47,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>date</th>\n",
       "      <th>open</th>\n",
       "      <th>close</th>\n",
       "      <th>high</th>\n",
       "      <th>low</th>\n",
       "      <th>volume</th>\n",
       "      <th>code</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2016-01-04</td>\n",
       "      <td>59.409</td>\n",
       "      <td>53.817</td>\n",
       "      <td>59.659</td>\n",
       "      <td>53.817</td>\n",
       "      <td>126863</td>\n",
       "      <td>300017</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2016-01-05</td>\n",
       "      <td>48.435</td>\n",
       "      <td>55.631</td>\n",
       "      <td>56.798</td>\n",
       "      <td>48.435</td>\n",
       "      <td>305224</td>\n",
       "      <td>300017</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2016-01-06</td>\n",
       "      <td>55.821</td>\n",
       "      <td>55.462</td>\n",
       "      <td>56.788</td>\n",
       "      <td>54.316</td>\n",
       "      <td>149785</td>\n",
       "      <td>300017</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "         date    open   close    high     low  volume    code\n",
       "0  2016-01-04  59.409  53.817  59.659  53.817  126863  300017\n",
       "1  2016-01-05  48.435  55.631  56.798  48.435  305224  300017\n",
       "2  2016-01-06  55.821  55.462  56.788  54.316  149785  300017"
      ]
     },
     "execution_count": 47,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df.head(3)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 48,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "u\"['2016-01-04',59.409,53.817,53.817,59.659],['2016-01-05',48.435,55.631,48.435,56.798],['2016-01-06',55.821,55.462,54.316,56.788],['2016-01-07',54.326,49.92,49.92,54.326],['2016-01-08',52.242,50.189,44.926,52.332],['2016-01-11',48.853,48.325,48.076,51.854],['2016-01-12',50.049,53.159,50.049,53.159],['2016-01-13',53.159,52.751,51.834,54.206],['2016-01-14',50.837,56.449,49.85,56.778],['2016-01-15',55.322,54.316,53.249,56.22],['2016-01-18',53.319,55.322,52.85,56.818],['2016-01-19',55.123,56.14,54.106,56.299],['2016-01-20',55.701,54.106,54.027,55.771],['2016-01-21',53.08,51.295,50.837,55.572],['2016-01-22',51.844,52.681,50.458,53.149],['2016-01-25',53.08,54.076,52.93,54.924],['2016-01-26',53.927,51.774,50.657,54.505],['2016-01-27',51.654,52.571,49.242,52.631],['2016-01-28',51.844,50.119,49.94,52.83],['2016-01-29',50.139,52.033,49.352,52.711],['2016-02-01',51.784,53.429,51.435,54.485],['2016-02-02',53.339,55.771,53.339,56.01],['2016-02-03',55.293,55.492,53.967,55.791],['2016-02-04',55.482,56.608,55.482,57.705],['2016-02-05',56.628,55.641,55.522,56.768],['2016-02-15',54.326,57.316,54.216,57.665],['2016-02-16',57.276,58.961,57.226,60.037],['2016-02-17',58.811,58.602,57.476,59.668],['2016-02-18',59.11,57.914,57.745,59.31],['2016-02-19',57.814,57.675,56.838,58.552],['2016-02-22',58.024,58.064,57.226,58.383],['2016-02-23',58.004,56.15,55.183,58.582],['2016-02-24',56.14,56.379,54.615,56.708],['2016-02-25',56.618,51.893,51.425,56.618],['2016-02-26',51.913,53.877,51.913,54.455],['2016-02-29',53.588,51.744,50.438,53.807],['2016-03-01',52.133,52.033,49.023,52.811],['2016-03-02',52.601,53.827,51.285,53.867],['2016-03-03',53.817,52.741,52.711,54.525],['2016-03-04',51.893,49.92,49.84,52.561],['2016-03-07',50.388,50.757,50.269,52.183],['2016-03-08',50.697,52.422,48.415,52.99],['2016-03-09',51.734,51.136,51.106,52.83],['2016-03-10',51.216,50.528,49.94,51.714],['2016-03-11',49.87,50.538,49.631,51.056],['2016-03-14',51.335,53.03,51.216,53.827],['2016-03-15',52.95,52.96,52.143,53.219],['2016-03-16',53.708,52.531,52.003,53.827],['2016-03-17',52.84,55.263,52.561,55.621],['2016-03-18',55.342,56.489,55.342,57.555],['2016-03-21',57.017,57.137,56.03,58.492],['2016-03-22',56.917,55.821,55.731,56.917],['2016-03-23',55.821,56.718,55.631,56.848],['2016-03-24',56.22,56.349,55.821,57.595],['2016-03-25',56.02,57.446,55.93,57.725],['2016-03-28',57.715,56.808,56.618,59.08],['2016-03-29',56.618,55.362,55.033,57.117],['2016-03-30',55.851,57.545,55.851,57.814],['2016-03-31',57.844,58.223,57.844,59.509],['2016-04-01',58.512,58.702,57.296,59.11],['2016-04-05',58.313,59.469,58.024,59.798],['2016-04-06',59.479,59.688,59.13,60.456],['2016-04-07',59.718,57.785,57.785,60.107],['2016-04-08',57.605,57.067,56.379,57.605],['2016-04-11',57.635,58.263,57.625,59.29],['2016-04-12',58.323,58.303,57.515,58.692],['2016-04-13',58.422,58.602,58.293,59.948],['2016-04-14',59.17,59.33,58.712,59.838],['2016-04-15',59.609,58.712,58.512,59.778],['2016-04-18',58.313,57.864,57.266,58.333],['2016-04-19',58.014,57.715,57.336,58.781],['2016-04-20',57.715,56.319,54.724,58.692],['2016-04-21',55.532,55.721,55.532,56.698],['2016-04-22',55.661,56.688,55.352,56.698],['2016-04-25',56.778,57.406,55.721,57.575],['2016-04-26',57.316,57.705,56.688,57.755],['2016-04-27',58.801,62.101,58.791,63.476],['2016-04-28',62.25,62.769,60.795,63.137],['2016-04-29',62.95,63.81,62.5,66.9],['2016-05-03',63.76,64.65,63.51,66.03],['2016-05-04',64.29,63.71,63.5,65.74],['2016-05-05',63.33,63.56,62.65,64.74],['2016-05-06',63.99,62.09,61.78,64.08],['2016-05-09',62.1,62.92,61.21,63.4],['2016-05-10',62.67,63.44,61.58,64.06],['2016-05-11',63.89,61.51,61.5,64.0],['2016-05-12',60.0,61.78,59.58,62.09],['2016-05-13',61.7,62.78,61.3,63.94],['2016-05-16',62.21,64.0,61.62,64.19],['2016-05-17',63.89,64.17,63.0,65.55],['2016-05-18',63.37,63.86,62.76,65.57],['2016-05-19',63.9,66.61,63.9,67.72],['2016-05-20',65.8,66.7,65.54,66.88],['2016-05-23',66.7,67.0,66.5,69.08],['2016-05-24',67.1,66.2,65.28,67.66],['2016-05-25',66.51,64.8,64.33,67.0],['2016-05-26',64.48,65.35,62.82,65.65],['2016-05-27',65.01,64.05,63.76,65.34],['2016-05-30',63.89,64.75,62.8,65.3],['2016-05-31',65.19,67.06,64.7,67.45],['2016-06-01',67.1,67.34,66.4,67.75],['2016-06-02',66.99,66.9,65.93,67.26],['2016-06-03',66.88,69.04,66.52,70.47],['2016-06-06',69.05,69.93,68.49,70.02],['2016-06-07',69.88,68.6,68.0,69.88],['2016-06-08',68.51,69.0,67.91,70.44],['2016-06-13',68.1,66.42,66.42,70.0],['2016-06-14',66.15,66.97,66.1,67.6],['2016-06-15',66.5,69.39,66.21,69.8],['2016-06-16',69.45,66.9,66.8,69.7],['2016-06-17',67.1,66.36,65.8,68.15],['2016-06-20',66.01,67.0,64.29,67.49],['2016-06-21',67.22,65.55,65.5,67.4],['2016-06-22',65.19,66.49,65.01,66.5],['2016-06-23',66.2,65.29,65.0,66.4],['2016-06-24',64.98,64.97,63.51,65.94],['2016-06-27',64.9,67.05,64.9,67.28],['2016-06-28',66.7,67.25,66.56,67.94],['2016-06-29',67.68,67.21,66.7,67.86],['2016-06-30',67.37,67.2,67.0,67.84],['2016-07-01',67.58,67.88,67.11,68.98],['2016-07-04',67.5,68.82,67.21,68.85],['2016-07-05',68.83,68.03,67.98,69.45],['2016-07-06',67.78,67.62,67.2,68.5],['2016-07-07',67.6,66.12,65.81,67.68],['2016-07-08',66.05,66.35,65.85,66.96],['2016-07-11',66.3,67.9,66.3,69.1],['2016-07-12',67.9,71.0,67.31,71.41],['2016-07-13',71.0,72.01,70.24,73.55],['2016-07-14',71.01,72.04,71.0,73.51],['2016-07-15',72.13,74.7,72.03,75.38],['2016-07-18',74.2,74.12,73.6,75.46],['2016-07-19',73.68,72.6,71.8,74.93],['2016-07-20',72.55,72.52,72.3,73.44],['2016-07-21',72.58,72.02,71.8,73.43],['2016-07-22',72.0,71.65,71.18,72.68],['2016-07-25',71.31,71.41,71.14,72.48],['2016-07-26',71.65,74.56,71.6,74.66],['2016-07-27',74.59,72.4,71.5,74.99],['2016-07-28',72.41,75.25,72.12,76.5],['2016-07-29',76.02,74.39,73.79,76.4],['2016-08-01',74.36,72.88,71.57,74.37],['2016-08-02',72.97,73.41,72.23,73.83],['2016-08-03',73.25,72.81,72.16,73.37],['2016-08-04',72.55,75.0,72.42,75.23],['2016-08-05',74.55,73.98,73.7,75.16],['2016-08-08',73.5,75.5,73.18,75.5],['2016-08-09',75.33,75.09,74.34,75.58],['2016-08-10',74.98,73.82,73.61,75.2],['2016-08-11',73.51,71.56,71.5,74.05],['2016-08-12',71.86,72.79,71.5,72.88],['2016-08-15',73.0,72.53,70.75,73.95],['2016-08-16',72.71,71.65,71.41,73.1],['2016-08-17',71.71,72.41,71.71,72.9],['2016-08-18',72.17,70.94,70.63,72.34],['2016-08-19',71.15,71.24,70.82,71.65],['2016-08-22',71.01,71.89,71.01,72.85],['2016-08-23',72.06,71.33,71.05,72.39],['2016-08-24',71.33,71.49,70.91,71.68],['2016-08-25',71.46,71.32,70.63,71.46],['2016-08-26',71.31,72.19,70.86,72.47],['2016-08-29',72.16,71.7,71.5,73.28],['2016-08-30',71.7,70.62,70.53,71.91],['2016-08-31',70.65,68.66,68.6,70.97],['2016-09-01',68.84,68.71,68.67,69.35],['2016-09-02',68.51,67.16,66.65,69.0],['2016-09-05',67.21,69.6,66.5,70.39],['2016-09-06',69.5,69.99,68.63,70.49],['2016-09-07',70.15,69.49,69.4,70.59],['2016-09-08',69.55,69.1,68.45,69.6],['2016-09-09',68.86,67.2,66.68,69.35],['2016-09-12',66.08,66.81,65.8,67.88],['2016-09-13',67.01,66.45,66.0,67.48],['2016-09-14',66.55,66.53,66.44,67.19],['2016-09-19',65.01,66.21,64.99,66.45],['2016-09-20',66.43,66.97,66.07,67.9],['2016-09-21',67.3,68.2,67.3,68.75],['2016-09-22',68.5,67.89,67.72,68.65],['2016-09-23',67.8,66.54,66.38,68.12],['2016-09-26',67.2,67.2,67.19,68.29],['2016-09-27',67.34,69.4,67.13,69.46],['2016-09-28',69.0,68.86,68.43,69.69],['2016-09-29',68.72,69.69,68.72,70.5],['2016-09-30',69.56,69.8,69.38,70.88],['2016-10-10',70.17,71.35,70.17,71.72],['2016-10-11',71.02,70.57,70.49,71.4],['2016-10-12',70.52,70.48,70.01,70.85],['2016-10-13',70.38,70.3,70.0,70.98],['2016-10-14',68.9,64.0,64.0,68.9],['2016-10-17',63.8,63.29,61.74,63.8],['2016-10-18',62.77,63.8,62.77,63.87],['2016-10-19',63.83,62.34,62.06,63.95],['2016-10-20',62.5,62.55,61.81,62.9],['2016-10-21',62.45,61.52,60.88,62.53],['2016-10-24',61.4,62.09,61.25,62.21],['2016-10-25',62.01,62.13,61.68,62.32],['2016-10-26',62.15,62.7,61.79,62.96],['2016-10-27',62.56,62.71,62.41,62.97],['2016-10-28',62.9,62.97,62.58,63.87],['2016-10-31',62.9,62.56,61.98,62.95],['2016-11-01',62.6,62.35,62.04,62.79],['2016-11-02',62.15,61.94,61.9,62.34],['2016-11-03',61.67,61.28,60.88,61.86],['2016-11-04',61.27,59.53,59.36,61.27],['2016-11-07',59.38,58.16,57.88,59.5],['2016-11-08',58.48,59.3,58.48,59.9],['2016-11-09',59.32,59.42,58.5,60.12],['2016-11-10',60.0,59.66,59.51,60.18],['2016-11-11',59.8,59.7,58.51,59.8],['2016-11-14',59.92,59.9,59.72,60.66],['2016-11-15',60.0,60.63,59.48,60.75],['2016-11-16',61.0,60.51,60.5,61.5],['2016-11-17',60.38,58.88,58.71,60.38],['2016-11-18',58.79,59.04,58.31,59.18],['2016-11-21',58.79,58.6,58.41,59.16],['2016-11-22',58.8,59.68,58.62,59.68],['2016-11-23',59.68,59.0,58.95,59.98],['2016-11-24',58.98,58.92,58.75,59.35],['2016-11-25',58.8,59.74,58.78,59.97],['2016-11-28',59.97,59.94,59.39,60.41],['2016-11-29',59.81,60.45,59.69,60.63],['2016-11-30',60.56,60.65,60.2,61.78],['2016-12-01',60.53,59.77,59.6,60.55],['2016-12-02',59.76,57.95,57.95,59.96],['2016-12-05',57.84,58.1,57.57,58.69],['2016-12-06',58.38,58.02,57.6,58.53],['2016-12-07',58.08,58.13,57.66,58.3],['2016-12-08',58.3,57.46,57.46,58.44],['2016-12-09',57.34,55.0,55.0,57.34],['2016-12-12',54.8,53.7,53.1,54.8],['2016-12-13',54.4,54.31,53.79,55.29],['2016-12-14',54.08,53.24,53.12,54.47],['2016-12-15',53.25,53.57,53.13,54.3],['2016-12-16',53.52,54.5,53.38,54.78],['2016-12-19',54.35,54.36,53.7,54.88],['2016-12-20',54.06,54.74,54.06,55.1],['2016-12-21',55.0,54.93,54.52,55.15],['2016-12-22',54.81,54.42,54.33,54.98],['2016-12-23',54.36,53.51,53.51,54.56],['2016-12-26',53.15,53.1,51.0,53.15],['2016-12-27',52.9,52.83,52.8,53.3],['2016-12-28',53.0,52.69,52.51,53.24],['2016-12-29',52.71,53.63,52.4,53.77],['2016-12-30',53.8,53.61,53.35,53.8]\""
      ]
     },
     "execution_count": 48,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "datastr"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 49,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "u'\\u7f51\\u5bbf\\u79d1\\u6280'"
      ]
     },
     "execution_count": 49,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "name"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 50,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": [
    "# 通过requireJS引入echarts包\n",
    "datahead = \"\"\"\n",
    "<div id=\"chart\" style='width:800px; height:600px;'></div>\n",
    "<script>\n",
    "    require.config({\n",
    "            paths:{\n",
    "                echarts:'//cdn.bootcss.com/echarts/3.2.3/echarts.min',\n",
    "                  }\n",
    "});\n",
    "    require(['echarts'],function(ec){\n",
    "var myChart = ec.init(document.getElementById('chart'));\n",
    "\"\"\"\n",
    "\n",
    "datavar = 'var data0 = splitData([%s]);' % datastr\n",
    "funcstr = \"\"\"\n",
    "function splitData(rawData){\n",
    "    var categoryData = [];\n",
    "    var values = []\n",
    "    for (var i = 0; i < rawData.length; i++) {\n",
    "        categoryData.push(rawData[i].splice(0,1)[0]);\n",
    "        values.push(rawData[i])\n",
    "        }\n",
    "    return {\n",
    "        categoryData: categoryData,\n",
    "        values: values\n",
    "        }\n",
    "}\n",
    "\n",
    "function calculateMA(dayCount){\n",
    "    var result = [];\n",
    "    for(var i=0,len=data0.values.length;i<len;i++){\n",
    "        if (i < dayCount){\n",
    "            result.push('-');\n",
    "            continue;\n",
    "        }\n",
    "        var sum = 0;\n",
    "        for (var j=0;j<dayCount;j++){\n",
    "            sum += data0.values[i-j][1];        \n",
    "        }\n",
    "        result.push((sum/dayCount).toFixed(2));\n",
    "    }\n",
    "    return result;\n",
    "}\n",
    "\n",
    "option = {\n",
    "        title: {\n",
    "\"\"\"\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 51,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "namestr = 'text: \\'%s\\',' %name\n",
    "functail = \"\"\"\n",
    "            left: 0\n",
    "        },\n",
    "        tooltip: {\n",
    "            trigger: 'axis',\n",
    "            axisPointer: {\n",
    "                type: 'line'\n",
    "            }\n",
    "        },\n",
    "        legend: {\n",
    "            data: ['日K', 'MA5', 'MA10', 'MA20', 'MA30']\n",
    "        },\n",
    "        grid: {\n",
    "            left: '10%',\n",
    "            right: '10%',\n",
    "            bottom: '15%'\n",
    "        },\n",
    "        xAxis: {\n",
    "            type: 'category',\n",
    "            data: data0.categoryData,\n",
    "            scale: true,\n",
    "            boundaryGap : false,\n",
    "            axisLine: {onZero: false},\n",
    "            splitLine: {show: false},\n",
    "            splitNumber: 20,\n",
    "            min: 'dataMin',\n",
    "            max: 'dataMax'\n",
    "        },\n",
    "        yAxis: {\n",
    "            scale: true,\n",
    "            splitArea: {\n",
    "                show: true\n",
    "            }\n",
    "        },\n",
    "        dataZoom: [\n",
    "            {\n",
    "                type: 'inside',\n",
    "                start: 50,\n",
    "                end: 100\n",
    "            },\n",
    "            {\n",
    "                show: true,\n",
    "                type: 'slider',\n",
    "                y: '90%',\n",
    "                start: 50,\n",
    "                end: 100\n",
    "            }\n",
    "        ],\n",
    "        series: [\n",
    "            {\n",
    "                name: '日K',\n",
    "                type: 'candlestick',\n",
    "                data: data0.values,\n",
    "                markPoint: {\n",
    "                    label: {\n",
    "                        normal: {\n",
    "                            formatter: function (param) {\n",
    "                                return param != null ? Math.round(param.value) : '';\n",
    "                            }\n",
    "                        }\n",
    "                    },\n",
    "                    data: [\n",
    "                        {\n",
    "                            name: '标点',\n",
    "                            coord: ['2013/5/31', 2300],\n",
    "                            value: 2300,\n",
    "                            itemStyle: {\n",
    "                                normal: {color: 'rgb(41,60,85)'}\n",
    "                            }\n",
    "                       },\n",
    "                        {\n",
    "                            name: 'highest value',\n",
    "                            type: 'max',\n",
    "                            valueDim: 'highest'\n",
    "                        },\n",
    "                        {\n",
    "                            name: 'lowest value',\n",
    "                            type: 'min',\n",
    "                            valueDim: 'lowest'\n",
    "                        },\n",
    "                        {\n",
    "                            name: 'average value on close',\n",
    "                            type: 'average',\n",
    "                            valueDim: 'close'\n",
    "                        }\n",
    "                    ],\n",
    "                    tooltip: {\n",
    "                        formatter: function (param) {\n",
    "                            return param.name + '<br>' + (param.data.coord || '');\n",
    "                        }\n",
    "                    }\n",
    "                },\n",
    "                markLine: {\n",
    "                    symbol: ['none', 'none'],\n",
    "                    data: [\n",
    "                        [\n",
    "                            {\n",
    "                                name: 'from lowest to highest',\n",
    "                                type: 'min',\n",
    "                                valueDim: 'lowest',\n",
    "                                symbol: 'circle',\n",
    "                                symbolSize: 10,\n",
    "                                label: {\n",
    "                                    normal: {show: false},\n",
    "                                    emphasis: {show: false}\n",
    "                                }\n",
    "                            },\n",
    "                            {\n",
    "                                type: 'max',\n",
    "                                valueDim: 'highest',\n",
    "                                symbol: 'circle',\n",
    "                                symbolSize: 10,\n",
    "                                label: {\n",
    "                                    normal: {show: false},\n",
    "                                    emphasis: {show: false}\n",
    "                               }\n",
    "                            }\n",
    "                        ],\n",
    "                        {\n",
    "                            name: 'min line on close',\n",
    "                            type: 'min',\n",
    "                            valueDim: 'close'\n",
    "                        },\n",
    "                        {\n",
    "                            name: 'max line on close',\n",
    "                            type: 'max',\n",
    "                            valueDim: 'close'\n",
    "                        }\n",
    "                    ]\n",
    "                }\n",
    "           },\n",
    "            {\n",
    "                name: 'MA5',\n",
    "                type: 'line',\n",
    "                data: calculateMA(5),\n",
    "                smooth: true,\n",
    "                lineStyle: {\n",
    "                    normal: {opacity: 0.5}\n",
    "                }\n",
    "            },\n",
    "           {\n",
    "               name: 'MA10',\n",
    "               type: 'line',\n",
    "                data: calculateMA(10),\n",
    "               smooth: true,\n",
    "                lineStyle: {\n",
    "                    normal: {opacity: 0.5}\n",
    "                }\n",
    "            },\n",
    "            {\n",
    "                name: 'MA20',\n",
    "                type: 'line',\n",
    "                data: calculateMA(20),\n",
    "                smooth: true,\n",
    "                lineStyle: {\n",
    "                    normal: {opacity: 0.5}\n",
    "                }\n",
    "            },\n",
    "            {\n",
    "                name: 'MA30',\n",
    "                type: 'line',\n",
    "                data: calculateMA(30),\n",
    "                smooth: true,\n",
    "                lineStyle: {\n",
    "                    normal: {opacity: 0.5}\n",
    "                }\n",
    "            },\n",
    "            \n",
    "        ]\n",
    "    };\n",
    "    myChart.setOption(option);\n",
    "        });\n",
    "</script>\n",
    "\"\"\""
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 52,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "\n",
       "<div id=\"chart\" style='width:800px; height:600px;'></div>\n",
       "<script>\n",
       "    require.config({\n",
       "            paths:{\n",
       "                echarts:'//cdn.bootcss.com/echarts/3.2.3/echarts.min',\n",
       "                  }\n",
       "});\n",
       "    require(['echarts'],function(ec){\n",
       "var myChart = ec.init(document.getElementById('chart'));\n",
       "var data0 = splitData([['2016-01-04',59.409,53.817,53.817,59.659],['2016-01-05',48.435,55.631,48.435,56.798],['2016-01-06',55.821,55.462,54.316,56.788],['2016-01-07',54.326,49.92,49.92,54.326],['2016-01-08',52.242,50.189,44.926,52.332],['2016-01-11',48.853,48.325,48.076,51.854],['2016-01-12',50.049,53.159,50.049,53.159],['2016-01-13',53.159,52.751,51.834,54.206],['2016-01-14',50.837,56.449,49.85,56.778],['2016-01-15',55.322,54.316,53.249,56.22],['2016-01-18',53.319,55.322,52.85,56.818],['2016-01-19',55.123,56.14,54.106,56.299],['2016-01-20',55.701,54.106,54.027,55.771],['2016-01-21',53.08,51.295,50.837,55.572],['2016-01-22',51.844,52.681,50.458,53.149],['2016-01-25',53.08,54.076,52.93,54.924],['2016-01-26',53.927,51.774,50.657,54.505],['2016-01-27',51.654,52.571,49.242,52.631],['2016-01-28',51.844,50.119,49.94,52.83],['2016-01-29',50.139,52.033,49.352,52.711],['2016-02-01',51.784,53.429,51.435,54.485],['2016-02-02',53.339,55.771,53.339,56.01],['2016-02-03',55.293,55.492,53.967,55.791],['2016-02-04',55.482,56.608,55.482,57.705],['2016-02-05',56.628,55.641,55.522,56.768],['2016-02-15',54.326,57.316,54.216,57.665],['2016-02-16',57.276,58.961,57.226,60.037],['2016-02-17',58.811,58.602,57.476,59.668],['2016-02-18',59.11,57.914,57.745,59.31],['2016-02-19',57.814,57.675,56.838,58.552],['2016-02-22',58.024,58.064,57.226,58.383],['2016-02-23',58.004,56.15,55.183,58.582],['2016-02-24',56.14,56.379,54.615,56.708],['2016-02-25',56.618,51.893,51.425,56.618],['2016-02-26',51.913,53.877,51.913,54.455],['2016-02-29',53.588,51.744,50.438,53.807],['2016-03-01',52.133,52.033,49.023,52.811],['2016-03-02',52.601,53.827,51.285,53.867],['2016-03-03',53.817,52.741,52.711,54.525],['2016-03-04',51.893,49.92,49.84,52.561],['2016-03-07',50.388,50.757,50.269,52.183],['2016-03-08',50.697,52.422,48.415,52.99],['2016-03-09',51.734,51.136,51.106,52.83],['2016-03-10',51.216,50.528,49.94,51.714],['2016-03-11',49.87,50.538,49.631,51.056],['2016-03-14',51.335,53.03,51.216,53.827],['2016-03-15',52.95,52.96,52.143,53.219],['2016-03-16',53.708,52.531,52.003,53.827],['2016-03-17',52.84,55.263,52.561,55.621],['2016-03-18',55.342,56.489,55.342,57.555],['2016-03-21',57.017,57.137,56.03,58.492],['2016-03-22',56.917,55.821,55.731,56.917],['2016-03-23',55.821,56.718,55.631,56.848],['2016-03-24',56.22,56.349,55.821,57.595],['2016-03-25',56.02,57.446,55.93,57.725],['2016-03-28',57.715,56.808,56.618,59.08],['2016-03-29',56.618,55.362,55.033,57.117],['2016-03-30',55.851,57.545,55.851,57.814],['2016-03-31',57.844,58.223,57.844,59.509],['2016-04-01',58.512,58.702,57.296,59.11],['2016-04-05',58.313,59.469,58.024,59.798],['2016-04-06',59.479,59.688,59.13,60.456],['2016-04-07',59.718,57.785,57.785,60.107],['2016-04-08',57.605,57.067,56.379,57.605],['2016-04-11',57.635,58.263,57.625,59.29],['2016-04-12',58.323,58.303,57.515,58.692],['2016-04-13',58.422,58.602,58.293,59.948],['2016-04-14',59.17,59.33,58.712,59.838],['2016-04-15',59.609,58.712,58.512,59.778],['2016-04-18',58.313,57.864,57.266,58.333],['2016-04-19',58.014,57.715,57.336,58.781],['2016-04-20',57.715,56.319,54.724,58.692],['2016-04-21',55.532,55.721,55.532,56.698],['2016-04-22',55.661,56.688,55.352,56.698],['2016-04-25',56.778,57.406,55.721,57.575],['2016-04-26',57.316,57.705,56.688,57.755],['2016-04-27',58.801,62.101,58.791,63.476],['2016-04-28',62.25,62.769,60.795,63.137],['2016-04-29',62.95,63.81,62.5,66.9],['2016-05-03',63.76,64.65,63.51,66.03],['2016-05-04',64.29,63.71,63.5,65.74],['2016-05-05',63.33,63.56,62.65,64.74],['2016-05-06',63.99,62.09,61.78,64.08],['2016-05-09',62.1,62.92,61.21,63.4],['2016-05-10',62.67,63.44,61.58,64.06],['2016-05-11',63.89,61.51,61.5,64.0],['2016-05-12',60.0,61.78,59.58,62.09],['2016-05-13',61.7,62.78,61.3,63.94],['2016-05-16',62.21,64.0,61.62,64.19],['2016-05-17',63.89,64.17,63.0,65.55],['2016-05-18',63.37,63.86,62.76,65.57],['2016-05-19',63.9,66.61,63.9,67.72],['2016-05-20',65.8,66.7,65.54,66.88],['2016-05-23',66.7,67.0,66.5,69.08],['2016-05-24',67.1,66.2,65.28,67.66],['2016-05-25',66.51,64.8,64.33,67.0],['2016-05-26',64.48,65.35,62.82,65.65],['2016-05-27',65.01,64.05,63.76,65.34],['2016-05-30',63.89,64.75,62.8,65.3],['2016-05-31',65.19,67.06,64.7,67.45],['2016-06-01',67.1,67.34,66.4,67.75],['2016-06-02',66.99,66.9,65.93,67.26],['2016-06-03',66.88,69.04,66.52,70.47],['2016-06-06',69.05,69.93,68.49,70.02],['2016-06-07',69.88,68.6,68.0,69.88],['2016-06-08',68.51,69.0,67.91,70.44],['2016-06-13',68.1,66.42,66.42,70.0],['2016-06-14',66.15,66.97,66.1,67.6],['2016-06-15',66.5,69.39,66.21,69.8],['2016-06-16',69.45,66.9,66.8,69.7],['2016-06-17',67.1,66.36,65.8,68.15],['2016-06-20',66.01,67.0,64.29,67.49],['2016-06-21',67.22,65.55,65.5,67.4],['2016-06-22',65.19,66.49,65.01,66.5],['2016-06-23',66.2,65.29,65.0,66.4],['2016-06-24',64.98,64.97,63.51,65.94],['2016-06-27',64.9,67.05,64.9,67.28],['2016-06-28',66.7,67.25,66.56,67.94],['2016-06-29',67.68,67.21,66.7,67.86],['2016-06-30',67.37,67.2,67.0,67.84],['2016-07-01',67.58,67.88,67.11,68.98],['2016-07-04',67.5,68.82,67.21,68.85],['2016-07-05',68.83,68.03,67.98,69.45],['2016-07-06',67.78,67.62,67.2,68.5],['2016-07-07',67.6,66.12,65.81,67.68],['2016-07-08',66.05,66.35,65.85,66.96],['2016-07-11',66.3,67.9,66.3,69.1],['2016-07-12',67.9,71.0,67.31,71.41],['2016-07-13',71.0,72.01,70.24,73.55],['2016-07-14',71.01,72.04,71.0,73.51],['2016-07-15',72.13,74.7,72.03,75.38],['2016-07-18',74.2,74.12,73.6,75.46],['2016-07-19',73.68,72.6,71.8,74.93],['2016-07-20',72.55,72.52,72.3,73.44],['2016-07-21',72.58,72.02,71.8,73.43],['2016-07-22',72.0,71.65,71.18,72.68],['2016-07-25',71.31,71.41,71.14,72.48],['2016-07-26',71.65,74.56,71.6,74.66],['2016-07-27',74.59,72.4,71.5,74.99],['2016-07-28',72.41,75.25,72.12,76.5],['2016-07-29',76.02,74.39,73.79,76.4],['2016-08-01',74.36,72.88,71.57,74.37],['2016-08-02',72.97,73.41,72.23,73.83],['2016-08-03',73.25,72.81,72.16,73.37],['2016-08-04',72.55,75.0,72.42,75.23],['2016-08-05',74.55,73.98,73.7,75.16],['2016-08-08',73.5,75.5,73.18,75.5],['2016-08-09',75.33,75.09,74.34,75.58],['2016-08-10',74.98,73.82,73.61,75.2],['2016-08-11',73.51,71.56,71.5,74.05],['2016-08-12',71.86,72.79,71.5,72.88],['2016-08-15',73.0,72.53,70.75,73.95],['2016-08-16',72.71,71.65,71.41,73.1],['2016-08-17',71.71,72.41,71.71,72.9],['2016-08-18',72.17,70.94,70.63,72.34],['2016-08-19',71.15,71.24,70.82,71.65],['2016-08-22',71.01,71.89,71.01,72.85],['2016-08-23',72.06,71.33,71.05,72.39],['2016-08-24',71.33,71.49,70.91,71.68],['2016-08-25',71.46,71.32,70.63,71.46],['2016-08-26',71.31,72.19,70.86,72.47],['2016-08-29',72.16,71.7,71.5,73.28],['2016-08-30',71.7,70.62,70.53,71.91],['2016-08-31',70.65,68.66,68.6,70.97],['2016-09-01',68.84,68.71,68.67,69.35],['2016-09-02',68.51,67.16,66.65,69.0],['2016-09-05',67.21,69.6,66.5,70.39],['2016-09-06',69.5,69.99,68.63,70.49],['2016-09-07',70.15,69.49,69.4,70.59],['2016-09-08',69.55,69.1,68.45,69.6],['2016-09-09',68.86,67.2,66.68,69.35],['2016-09-12',66.08,66.81,65.8,67.88],['2016-09-13',67.01,66.45,66.0,67.48],['2016-09-14',66.55,66.53,66.44,67.19],['2016-09-19',65.01,66.21,64.99,66.45],['2016-09-20',66.43,66.97,66.07,67.9],['2016-09-21',67.3,68.2,67.3,68.75],['2016-09-22',68.5,67.89,67.72,68.65],['2016-09-23',67.8,66.54,66.38,68.12],['2016-09-26',67.2,67.2,67.19,68.29],['2016-09-27',67.34,69.4,67.13,69.46],['2016-09-28',69.0,68.86,68.43,69.69],['2016-09-29',68.72,69.69,68.72,70.5],['2016-09-30',69.56,69.8,69.38,70.88],['2016-10-10',70.17,71.35,70.17,71.72],['2016-10-11',71.02,70.57,70.49,71.4],['2016-10-12',70.52,70.48,70.01,70.85],['2016-10-13',70.38,70.3,70.0,70.98],['2016-10-14',68.9,64.0,64.0,68.9],['2016-10-17',63.8,63.29,61.74,63.8],['2016-10-18',62.77,63.8,62.77,63.87],['2016-10-19',63.83,62.34,62.06,63.95],['2016-10-20',62.5,62.55,61.81,62.9],['2016-10-21',62.45,61.52,60.88,62.53],['2016-10-24',61.4,62.09,61.25,62.21],['2016-10-25',62.01,62.13,61.68,62.32],['2016-10-26',62.15,62.7,61.79,62.96],['2016-10-27',62.56,62.71,62.41,62.97],['2016-10-28',62.9,62.97,62.58,63.87],['2016-10-31',62.9,62.56,61.98,62.95],['2016-11-01',62.6,62.35,62.04,62.79],['2016-11-02',62.15,61.94,61.9,62.34],['2016-11-03',61.67,61.28,60.88,61.86],['2016-11-04',61.27,59.53,59.36,61.27],['2016-11-07',59.38,58.16,57.88,59.5],['2016-11-08',58.48,59.3,58.48,59.9],['2016-11-09',59.32,59.42,58.5,60.12],['2016-11-10',60.0,59.66,59.51,60.18],['2016-11-11',59.8,59.7,58.51,59.8],['2016-11-14',59.92,59.9,59.72,60.66],['2016-11-15',60.0,60.63,59.48,60.75],['2016-11-16',61.0,60.51,60.5,61.5],['2016-11-17',60.38,58.88,58.71,60.38],['2016-11-18',58.79,59.04,58.31,59.18],['2016-11-21',58.79,58.6,58.41,59.16],['2016-11-22',58.8,59.68,58.62,59.68],['2016-11-23',59.68,59.0,58.95,59.98],['2016-11-24',58.98,58.92,58.75,59.35],['2016-11-25',58.8,59.74,58.78,59.97],['2016-11-28',59.97,59.94,59.39,60.41],['2016-11-29',59.81,60.45,59.69,60.63],['2016-11-30',60.56,60.65,60.2,61.78],['2016-12-01',60.53,59.77,59.6,60.55],['2016-12-02',59.76,57.95,57.95,59.96],['2016-12-05',57.84,58.1,57.57,58.69],['2016-12-06',58.38,58.02,57.6,58.53],['2016-12-07',58.08,58.13,57.66,58.3],['2016-12-08',58.3,57.46,57.46,58.44],['2016-12-09',57.34,55.0,55.0,57.34],['2016-12-12',54.8,53.7,53.1,54.8],['2016-12-13',54.4,54.31,53.79,55.29],['2016-12-14',54.08,53.24,53.12,54.47],['2016-12-15',53.25,53.57,53.13,54.3],['2016-12-16',53.52,54.5,53.38,54.78],['2016-12-19',54.35,54.36,53.7,54.88],['2016-12-20',54.06,54.74,54.06,55.1],['2016-12-21',55.0,54.93,54.52,55.15],['2016-12-22',54.81,54.42,54.33,54.98],['2016-12-23',54.36,53.51,53.51,54.56],['2016-12-26',53.15,53.1,51.0,53.15],['2016-12-27',52.9,52.83,52.8,53.3],['2016-12-28',53.0,52.69,52.51,53.24],['2016-12-29',52.71,53.63,52.4,53.77],['2016-12-30',53.8,53.61,53.35,53.8]]);\n",
       "function splitData(rawData){\n",
       "    var categoryData = [];\n",
       "    var values = []\n",
       "    for (var i = 0; i < rawData.length; i++) {\n",
       "        categoryData.push(rawData[i].splice(0,1)[0]);\n",
       "        values.push(rawData[i])\n",
       "        }\n",
       "    return {\n",
       "        categoryData: categoryData,\n",
       "        values: values\n",
       "        }\n",
       "}\n",
       "\n",
       "function calculateMA(dayCount){\n",
       "    var result = [];\n",
       "    for(var i=0,len=data0.values.length;i<len;i++){\n",
       "        if (i < dayCount){\n",
       "            result.push('-');\n",
       "            continue;\n",
       "        }\n",
       "        var sum = 0;\n",
       "        for (var j=0;j<dayCount;j++){\n",
       "            sum += data0.values[i-j][1];        \n",
       "        }\n",
       "        result.push((sum/dayCount).toFixed(2));\n",
       "    }\n",
       "    return result;\n",
       "}\n",
       "\n",
       "option = {\n",
       "        title: {\n",
       "text: '网宿科技',\n",
       "            left: 0\n",
       "        },\n",
       "        tooltip: {\n",
       "            trigger: 'axis',\n",
       "            axisPointer: {\n",
       "                type: 'line'\n",
       "            }\n",
       "        },\n",
       "        legend: {\n",
       "            data: ['日K', 'MA5', 'MA10', 'MA20', 'MA30']\n",
       "        },\n",
       "        grid: {\n",
       "            left: '10%',\n",
       "            right: '10%',\n",
       "            bottom: '15%'\n",
       "        },\n",
       "        xAxis: {\n",
       "            type: 'category',\n",
       "            data: data0.categoryData,\n",
       "            scale: true,\n",
       "            boundaryGap : false,\n",
       "            axisLine: {onZero: false},\n",
       "            splitLine: {show: false},\n",
       "            splitNumber: 20,\n",
       "            min: 'dataMin',\n",
       "            max: 'dataMax'\n",
       "        },\n",
       "        yAxis: {\n",
       "            scale: true,\n",
       "            splitArea: {\n",
       "                show: true\n",
       "            }\n",
       "        },\n",
       "        dataZoom: [\n",
       "            {\n",
       "                type: 'inside',\n",
       "                start: 50,\n",
       "                end: 100\n",
       "            },\n",
       "            {\n",
       "                show: true,\n",
       "                type: 'slider',\n",
       "                y: '90%',\n",
       "                start: 50,\n",
       "                end: 100\n",
       "            }\n",
       "        ],\n",
       "        series: [\n",
       "            {\n",
       "                name: '日K',\n",
       "                type: 'candlestick',\n",
       "                data: data0.values,\n",
       "                markPoint: {\n",
       "                    label: {\n",
       "                        normal: {\n",
       "                            formatter: function (param) {\n",
       "                                return param != null ? Math.round(param.value) : '';\n",
       "                            }\n",
       "                        }\n",
       "                    },\n",
       "                    data: [\n",
       "                        {\n",
       "                            name: '标点',\n",
       "                            coord: ['2013/5/31', 2300],\n",
       "                            value: 2300,\n",
       "                            itemStyle: {\n",
       "                                normal: {color: 'rgb(41,60,85)'}\n",
       "                            }\n",
       "                       },\n",
       "                        {\n",
       "                            name: 'highest value',\n",
       "                            type: 'max',\n",
       "                            valueDim: 'highest'\n",
       "                        },\n",
       "                        {\n",
       "                            name: 'lowest value',\n",
       "                            type: 'min',\n",
       "                            valueDim: 'lowest'\n",
       "                        },\n",
       "                        {\n",
       "                            name: 'average value on close',\n",
       "                            type: 'average',\n",
       "                            valueDim: 'close'\n",
       "                        }\n",
       "                    ],\n",
       "                    tooltip: {\n",
       "                        formatter: function (param) {\n",
       "                            return param.name + '<br>' + (param.data.coord || '');\n",
       "                        }\n",
       "                    }\n",
       "                },\n",
       "                markLine: {\n",
       "                    symbol: ['none', 'none'],\n",
       "                    data: [\n",
       "                        [\n",
       "                            {\n",
       "                                name: 'from lowest to highest',\n",
       "                                type: 'min',\n",
       "                                valueDim: 'lowest',\n",
       "                                symbol: 'circle',\n",
       "                                symbolSize: 10,\n",
       "                                label: {\n",
       "                                    normal: {show: false},\n",
       "                                    emphasis: {show: false}\n",
       "                                }\n",
       "                            },\n",
       "                            {\n",
       "                                type: 'max',\n",
       "                                valueDim: 'highest',\n",
       "                                symbol: 'circle',\n",
       "                                symbolSize: 10,\n",
       "                                label: {\n",
       "                                    normal: {show: false},\n",
       "                                    emphasis: {show: false}\n",
       "                               }\n",
       "                            }\n",
       "                        ],\n",
       "                        {\n",
       "                            name: 'min line on close',\n",
       "                            type: 'min',\n",
       "                            valueDim: 'close'\n",
       "                        },\n",
       "                        {\n",
       "                            name: 'max line on close',\n",
       "                            type: 'max',\n",
       "                            valueDim: 'close'\n",
       "                        }\n",
       "                    ]\n",
       "                }\n",
       "           },\n",
       "            {\n",
       "                name: 'MA5',\n",
       "                type: 'line',\n",
       "                data: calculateMA(5),\n",
       "                smooth: true,\n",
       "                lineStyle: {\n",
       "                    normal: {opacity: 0.5}\n",
       "                }\n",
       "            },\n",
       "           {\n",
       "               name: 'MA10',\n",
       "               type: 'line',\n",
       "                data: calculateMA(10),\n",
       "               smooth: true,\n",
       "                lineStyle: {\n",
       "                    normal: {opacity: 0.5}\n",
       "                }\n",
       "            },\n",
       "            {\n",
       "                name: 'MA20',\n",
       "                type: 'line',\n",
       "                data: calculateMA(20),\n",
       "                smooth: true,\n",
       "                lineStyle: {\n",
       "                    normal: {opacity: 0.5}\n",
       "                }\n",
       "            },\n",
       "            {\n",
       "                name: 'MA30',\n",
       "                type: 'line',\n",
       "                data: calculateMA(30),\n",
       "                smooth: true,\n",
       "                lineStyle: {\n",
       "                    normal: {opacity: 0.5}\n",
       "                }\n",
       "            },\n",
       "            \n",
       "        ]\n",
       "    };\n",
       "    myChart.setOption(option);\n",
       "        });\n",
       "</script>\n"
      ],
      "text/plain": [
       "<IPython.core.display.HTML object>"
      ]
     },
     "execution_count": 52,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "HTML(datahead + datavar + funcstr + namestr + functail)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 2",
   "language": "python",
   "name": "python2"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 2
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython2",
   "version": "2.7.12"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 0
}
